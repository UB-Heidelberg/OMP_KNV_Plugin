{{from gluon.serializers import xml
import re
}}
{{
#Für Hardcover eine andere XML

submission_id = request.args[0]

}}
<ONIXmessage release="2.1">
    <header>
        <m174>Universitätsbibliothek Heidelberg</m174> 
        <m175> Anja Konopka, +49 6221 54 2569</m175> 
        <m283>konopka@ub.uni-heidelberg.de</m283>
        <m182>{{=sent_date}}</m182> <!--TODO kommt aus t_onix_additionals.f_sent_date -->
    </header>
    <product datestamp="{{=publication_date}}"> <!--TODO-->
        <a001>{{=isbn_number}}</a001>
        <a002>{{=notification_type}}</a002>
       
        <productidentifier>
            <b221>{{=notification_type}}</b221>  
            <b244>{{=isbn_number}}</b244> 
        </productidentifier>
        <b012>{{=entry_key}}</b012> 
         <!--series>
        <seriesidentifier>
            <b273>04</b273>
            <b244>XCX68</b244>
        </seriesidentifier>
        <b018>Universitätsmuseum Heidelberg. Kataloge</b018>
        <title>
            <b202>01</b202>
            <b203>Universitätsmuseum Heidelberg. Kataloge</b203>
        </title>
        </series-->
        <title>
            <b202>01</b202> 
            <b203>{{=title}}</b203>
            <b029>{{=sub_title}}</b029> 
        </title>
        
        <!--- Contributer ist eine schleife-->
        {{ 
        for author in authors:
        =XML('<contributor>')
        =XML('<b034>')
          =author.authors.seq
        =XML('</b034>')
        =XML('<b035>')
          ='B01'
        =XML('</b035>')
        =XML('<b340>')
          =author.authors.seq
        =XML('</b340>')
        =XML('<b036>')
          =" ".join([author.authors['first_name'],author.authors['middle_name'],author.authors['last_name']])
        =XML('</b036>')
        =XML('<b037>')
          =" ".join([", ".join([author.authors['last_name'], author.authors['first_name']]), author.authors['middle_name']])
        =XML('</b037>')
        =XML('<b039>')
          =" ".join([author.authors['first_name'],author.authors['middle_name']])
        =XML('</b039>')
        =XML('<b040>')
          =author.authors['last_name']
        =XML('</b040>')
        =XML('<b044>')
            =XML(author.author_settings['setting_value'])
        =XML('</b044>')
        
        
        =XML('</contributor>')
        =BR()
      
        pass
        }}
 
        

     
        <language>
            <b253>01</b253>
            <b252>{{=published_language}}</b252>
        </language>
        <b254>{{=pages_roman}}</b254>
        <b255>{{=pages_arabic}}</b255>
      
       <!-- mehrfach vorkommen - default, ohne othertext abstracts mit Parameter, kommt alle Abstracts -->
        <othertext language="ger">
            <d102>01</d102> <!--fest-->
            <d103>02</d103> <!--html -->
            <d104> <!--- Abstract  submission_settings.setting_name == 'abstract'-->
              
              Im Zuge eines "material turn" der historischen Forschung rücken die materiellen
                Aspekte frühneuzeitlicher Diplomatie zunehmend in den Fokus. Wie wurde Diplomatie
                finanziert? Welche Objekte wurden im Zuge des diplomatischen Geschenkverkehrs
                ausgetauscht? Welche Personenkreise wurden mit Gaben und gegebenenfalls
                Bestechungsgeldern bedacht? Die vorliegende Edition bisher unveröffentlichter
                Ausgabenabrechnung der kaiserlichen Gesandten in Konstantinopel Joachim von
                Sinzendorff und Friedrich Preiner aus dem Wiener Haus-, Hof- und Staatsarchiv
                liefert Antworten auf diese und vielfältige weitere Fragestellungen der neuen
                Diplomatiegeschichte. Ergänzt um ein umfangreiches Register und einen sachlichen
                Anmerkungsapparat, der besonderen Wert auf die Identifikation historischer Akteure
                sowie osmanischer Würdenträger und Fachbegriffe legt, eignet sich dieser Band
                sowohl für die historische Forschung, als auch für die Verwendung in der Lehre.
            </d104>
        </othertext>
        
         <mainsubject sourcename="Publisher">
           <!-- kommen direkt aus onix tabelle -->
            <b191>93</b191>
            <b068>1.1</b068>
            <b069>NHAP</b069>
            <b070>Geschichtsforschung: Quellen</b070>
        </mainsubject>
        <mainsubject>
            <b191>26</b191> <!-- fest -->
            <b068>2.0</b068>  <!-- fest -->
            <b069>1555</b069> <!-- kommen direkt aus onix tabelle -->
            <b070>Hardcover, Softcover / Geschichte/Neuzeit bis 1918</b070> <!-- kommen direkt aus onix tabelle -->
        </mainsubject>
         <!--todo  -->
        <!--subject>
            <b067>20</b067> 
            <b069>940</b069>
            
        </subject-->
        <!-- ende todo -->
       
        <mediafile>
            <f114>04</f114>
            <f115>03</f115>
            <f116>01</f116>
            <f117>http://api.vlb.de/api/v1/cover/9783946531029/m</f117>
        </mediafile>
        <publisher>
            <b291>01</b291> <!-- done -->
            <b241>{{=codeType}}</b241>
            <b243>{{=codeValue}}</b243> 
            <b081>{{=publisher}}</b081> 
        </publisher>
        <b209>Heidelberg</b209> <!-- TODO ????????????? omp.presses;.primary_locale -->
        <b083>{{=country_manufacture_code}}</b083> 
        <b394>{{=publication_available}}</b394>  <!-- TODO ???????????    in 43 steht xml-->
        <b003>{{=publication_date}}</b003> <!--  omp.publication_dates.date die Verbindung kommt mit Format  gel bekannt. Maße werden gebraucht für die Lagerlogistik -->
        <measure>
        <c093>01</c093><!-- Codelist 48. Format: Höhe.-->
        <c094>{{=height}}</c094> <!--Musterzahlen-->
        <c095>{{=height_unit_code}}</c095>
        </measure>
        <measure>
        <c093>02</c093>
        <!-- Codelist 48. Format: Breite.-->
        <c094>{{=width}}</c094>
        <c095>{{=width_unit_code}}</c095>
        </measure>
        <measure>
        <c093>03</c093>
        <!-- Codelist 48. Format: Tiefe.-->
        <c094>{{=thickness}}</c094>
        <c095>{{=thickness_unit_code}}</c095>
        </measure>
        <measure>
        <c093>08</c093>
        <!-- Codelist 48. Gewicht.-->
        <c094>{{=weight}}</c094> 
        <c095>{{=weight_unit_code}}</c095>
        </measure>  
        <supplydetail>
            <supplieridentifier>
                <j345>{{=press_code_type}}</j345> <!--  press_settings.codeType-->
                <b244>{{=press_code_value}}</b244><!-- press_settings.codeValue -->
            </supplieridentifier>
            <j137>{{=publisher}}</j137> <!-- OMP.omp.press_settings.publisher-->
            <j292>01</j292>   <!--done-->
             <!-- <j141>IP</j141> falls publication_format_settings.product_availability_code-->
            <j396>{{=product_availability_code}}</j396> <!-- publication_format_settings.product_availability_code-->
            <!-- wiederholung keine first()-->
            {{for price in prices:}}
            <price>
                <j148>{{=price['price_type_code']}}</j148>
                <j266>02</j266> 
                <j151>{{=price['price']}}</j151>      
                <j152>{{=price['currency_code']}}</j152>
                <b251>
                  {{t=re.findall('{(.*)}',price['countries_included'])}}
                  {{
                  if len(t[0]) > 0:
                    u=t[0].split(':')
                   if len(u)==4:
                    y = u[3]
                   z = re.findall('[^\W\d_]+',y)
                  if len(z) > 0:
                   =z[0]
                  else:
                   =''
                  pass
                  else:
                   =''
                  pass
                  
                  else:
                  =''
                  pass
                  }}
                </b251> 
                <j153>{{=price['tax_rate_code']}}</j153> 
            </price>
            {{pass}}
               
            
            
        </supplydetail>
    </product>

</ONIXmessage>
